{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} - HR System</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Our HR CSS Files -->
    <link rel="stylesheet" href="{% static 'css/hr-main.css' %}">
    <link rel="stylesheet" href="{% static 'css/hr-components.css' %}">
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <i class="fas fa-building"></i>
            <span>HR Portal</span>
        </div>

        <div class="nav-section">
            <div class="nav-title">Main Menu</div>
            <a href="{% url 'hr:hr_dashboard' %}" class="nav-item">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
            <a href="{% url 'hr:leave_dashboard' %}" class="nav-item active">
                <i class="fas fa-calendar-alt"></i>
                <span>Leave Dashboard</span>
            </a>
            <a href="{% url 'hr:my_leave_requests' %}" class="nav-item">
                <i class="fas fa-history"></i>
                <span>My Leaves</span>
            </a>
        </div>

        <div class="sidebar-divider"></div>

        <div class="nav-section sidebar-actions">
            <div class="nav-title">Quick Actions</div>
            <a href="{% url 'hr:leave_request_create' %}" class="sidebar-btn success active">
                <i class="fas fa-calendar-plus"></i>
                Request Leave
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="header">
            <h1>
                <i class="fas fa-file-alt"></i>
                {{ title }}
            </h1>
            <a href="{% url 'hr:leave_dashboard' %}" class="btn">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
            </a>
        </div>

        <!-- Main Form Card -->
        <div class="card" style="max-width: 800px; margin: 30px auto;">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-calendar-plus"></i>
                    Leave Request Form
                </h2>
            </div>

            <form method="post" enctype="multipart/form-data" style="padding: 30px;">
                {% csrf_token %}
                
                <!-- Employee Info -->
                {% if employee %}
                <div style="background: var(--gray-extra-light); padding: 20px; border-radius: var(--border-radius); margin-bottom: 30px;">
                    <h4 style="color: var(--dark); margin-bottom: 10px;">
                        <i class="fas fa-user"></i> Employee Information
                    </h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div>
                            <label style="color: var(--gray); font-size: 0.9em;">Name</label>
                            <div style="font-weight: 600;">{{ employee.full_name }}</div>
                        </div>
                        <div>
                            <label style="color: var(--gray); font-size: 0.9em;">Employee ID</label>
                            <div>{{ employee.employee_id|default:"Not assigned" }}</div>
                        </div>
                        <div>
                            <label style="color: var(--gray); font-size: 0.9em;">Department</label>
                            <div>{{ employee.department|default:"Not assigned" }}</div>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Form Fields -->
                {% for field in form %}
                <div class="form-group">
                    <label for="{{ field.id_for_label }}" class="form-label">
                        <i class="fas fa-{% if field.name == 'leave_type' %}tag{% elif field.name == 'start_date' %}calendar{% elif field.name == 'end_date' %}calendar-check{% elif field.name == 'days_requested' %}calculator{% else %}pencil-alt{% endif %}"></i>
                        {{ field.label }}
                        {% if field.field.required %}<span class="text-danger">*</span>{% endif %}
                    </label>
                    {{ field }}
                    
                    {% if field.help_text %}
                    <small class="form-text">{{ field.help_text }}</small>
                    {% endif %}
                    
                    {% if field.errors %}
                    <div class="error-message text-danger mt-1">
                        <i class="fas fa-exclamation-circle"></i> {{ field.errors|join:", " }}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}

                <!-- Leave Balance Info -->
                {% if employee and 'annual' in form.leave_type.value|lower %}
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    Your annual leave balance: <strong>{{ employee.get_annual_leave_balance|default:"0" }} days</strong>
                </div>
                {% endif %}

                <!-- Form Actions -->
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-paper-plane"></i> Submit Request
                    </button>
                    <a href="{% url 'hr:leave_dashboard' %}" class="btn btn-outline">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                </div>
            </form>
        </div>

        <!-- Leave Policy Info -->
        <div class="card info" style="max-width: 800px; margin: 30px auto;">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-info-circle"></i>
                    Leave Policy Guidelines
                </h2>
            </div>
            <div style="padding: 25px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div>
                        <h4 style="color: var(--dark); margin-bottom: 10px;">
                            <i class="fas fa-clock text-warning"></i> Advance Notice
                        </h4>
                        <p style="color: var(--gray);">Annual leave: 3 days minimum<br>Sick leave: 1 day minimum<br>Emergency: Within 24 hours</p>
                    </div>
                    <div>
                        <h4 style="color: var(--dark); margin-bottom: 10px;">
                            <i class="fas fa-file-medical text-danger"></i> Documentation
                        </h4>
                        <p style="color: var(--gray);">Sick leave > 3 days: Medical certificate<br>Bereavement: Death certificate<br>Maternity: Hospital records</p>
                    </div>
                    <div>
                        <h4 style="color: var(--dark); margin-bottom: 10px;">
                            <i class="fas fa-check-circle text-success"></i> Approval Process
                        </h4>
                        <p style="color: var(--gray);">Manager review within 48 hours<br>HR final approval<br>Finance processing after approval</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="{% static 'js/hr-main.js' %}"></script>
    
    <script>
        // Date validation
        $(document).ready(function() {
            const today = new Date().toISOString().split('T')[0];
            
            // Set min dates
            $('#id_start_date, #id_end_date').attr('min', today);
            
            // End date validation
            $('#id_start_date').change(function() {
                if (this.value) {
                    $('#id_end_date').attr('min', this.value);
                    
                    if ($('#id_end_date').val() && new Date(this.value) > new Date($('#id_end_date').val())) {
                        alert('Start date cannot be after end date');
                        this.value = '';
                    }
                }
            });
            
            // Start date validation
            $('#id_end_date').change(function() {
                if ($('#id_start_date').val() && new Date(this.value) < new Date($('#id_start_date').val())) {
                    alert('End date cannot be before start date');
                    this.value = '';
                }
            });
            
            // Auto-calculate days
            function calculateDays() {
                const start = $('#id_start_date').val();
                const end = $('#id_end_date').val();
                
                if (start && end) {
                    const startDate = new Date(start);
                    const endDate = new Date(end);
                    const diffTime = Math.abs(endDate - startDate);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
                    
                    if (diffDays > 0) {
                        $('#id_days_requested').val(diffDays);
                    }
                }
            }
            
            $('#id_start_date, #id_end_date').change(calculateDays);
        });
    </script>
</body>
</html>