{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR Dashboard</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Our HR CSS Files -->
    <link rel="stylesheet" href="{% static 'css/hr-main.css' %}">
    <link rel="stylesheet" href="{% static 'css/hr-components.css' %}">
    <link rel="stylesheet" href="{% static 'css/hr-responsive.css' %}">
    <link rel="stylesheet" href="{% static 'css/hr-notifications.css' %}">
</head>
<body>
    <!-- Notification Container -->
    <div id="notification-container"></div>
    
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <i class="fas fa-building"></i>
            <span>HR Portal</span>
        </div>

        <div class="nav-section">
            <div class="nav-title">Main Menu</div>
            <a href="/" class="nav-item active">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
            <a href="{% url 'hr:employee_list' %}" class="nav-item">
                <i class="fas fa-user-friends"></i>
                <span>All Employees</span>
            </a>
            <a href="{% url 'hr:leave_dashboard' %}" class="nav-item">
                <i class="fas fa-chart-bar"></i>
                <span>Leave Dashboard</span>
            </a>
            <a href="{% url 'hr:leave_approval_list' %}" class="nav-item">
                <i class="fas fa-check-circle"></i>
                <span>Approvals</span>
                {% if pending_count > 0 %}
                <span class="nav-badge">{{ pending_count }}</span>
                {% endif %}
            </a>
        </div>

        <div class="sidebar-divider"></div>

        <div class="nav-section">
            <div class="nav-title">Management</div>
            <a href="{% url 'hr:hr_leave_management' %}" class="nav-item">
                <i class="fas fa-cogs"></i>
                <span>Leave Management</span>
            </a>
            <a href="{% url 'hr:finance_leaves_view' %}" class="nav-item">
                <i class="fas fa-calculator"></i>
                <span>Payroll</span>
            </a>
            <a href="{% url 'hr:user_sync' %}" class="nav-item">
                <i class="fas fa-sync-alt"></i>
                <span>User Sync</span>
            </a>
        </div>

        <div class="sidebar-divider"></div>

        <div class="nav-section sidebar-actions">
            <div class="nav-title">Quick Actions</div>
            <a href="{% url 'hr:employee_create' %}" class="sidebar-btn success">
                <i class="fas fa-user-plus"></i>
                Add Employee
            </a>
            <a href="{% url 'hr:leave_request_create' %}" class="sidebar-btn">
                <i class="fas fa-calendar-plus"></i>
                Request Leave
            </a>
            <a href="{% url 'hr:hr_leave_add' %}" class="sidebar-btn danger">
                <i class="fas fa-user-times"></i>
                Add Absence
            </a>
        </div>
        <!-- Back to Main Dashboard & Logout Section -->
<div class="sidebar-bottom">
    <!-- Back to Main Dashboard Button -->
    <a href="/" class="back-to-main-btn">
        <i class="fas fa-arrow-left"></i>
        <span>Back to Main Dashboard</span>
    </a>
    
    <div class="user-info">
        <div class="user-avatar">
            {{ user.username|first|upper }}
        </div>
        <div class="user-details">
            <div class="user-name">{{ user.get_full_name|default:user.username }}</div>
            <div class="user-role">HR User</div>
        </div>
    </div>
    <form method="post" action="{% url 'logout' %}" class="logout-form">
        {% csrf_token %}
        <button type="submit" class="logout-btn">
            <i class="fas fa-sign-out-alt"></i>
            <span>Logout</span>
        </button>
    </form>
</div>
    </div>
    

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="header">
            <h1>
                <i class="fas fa-chart-line"></i>
                HR Dashboard
            </h1>
            <div class="header-right">
                <div class="user-info">
                    <div class="user-avatar">
                        {% if user.get_full_name %}
                            {{ user.get_full_name|first|upper }}
                        {% else %}
                            {{ user.username|first|upper }}
                        {% endif %}
                    </div>
                    <div>
                        <div style="color: var(--dark); font-weight: 600;">
                            {% if user.get_full_name %}
                                {{ user.get_full_name }}
                            {% else %}
                                {{ user.username }}
                            {% endif %}
                        </div>
                        <small style="color: var(--gray); font-size: 0.85em;">
                            {{ user.groups.first|default:"User" }}
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Django Messages -->
        {% if messages %}
        <div class="django-messages">
            {% for message in messages %}
            <div class="message-alert {{ message.tags }}">
                <div>
                    <i class="fas fa-info-circle me-2"></i>
                    {{ message }}
                </div>
                <button class="close-alert">&times;</button>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Quick Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <div>
                        <h3>Total Employees</h3>
                        <p class="stat-number">{{ total_employees }}</p>
                        <small class="stat-description">Active: {{ active_employees }}</small>
                    </div>
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                </div>
            </div>

            <div class="stat-card orange">
                <div class="stat-header">
                    <div>
                        <h3>Pending Leaves</h3>
                        <p class="stat-number">{{ total_pending_leaves|default:"0" }}</p>
                        <small class="stat-description">Awaiting approval</small>
                    </div>
                    <div class="stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                </div>
            </div>

            <div class="stat-card green">
                <div class="stat-header">
                    <div>
                        <h3>Today's Requests</h3>
                        <p class="stat-number">{{ today_leaves|default:"0" }}</p>
                        <small class="stat-description">Submitted today</small>
                    </div>
                    <div class="stat-icon">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                </div>
            </div>

            <div class="stat-card red">
                <div class="stat-header">
                    <div>
                        <h3>Active Absences</h3>
                        <p class="stat-number">{{ active_absences|default:"0" }}</p>
                        <small class="stat-description">Currently absent</small>
                    </div>
                    <div class="stat-icon">
                        <i class="fas fa-user-times"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Manager Approval Section -->
        {% if is_manager and user_has_employee and pending_approvals_count > 0 %}
        <div class="card manager">
            <div class="card-header">
                <div>
                    <h2 class="card-title">
                        <i class="fas fa-user-tie"></i>
                        Manager Approvals Needed
                    </h2>
                    <p class="card-subtitle">
                        You have <strong>{{ pending_approvals_count }}</strong> leave requests pending approval in your department.
                    </p>
                </div>
                <div class="card-icon">
                    <i class="fas fa-exclamation-circle"></i>
                </div>
            </div>

            <div class="action-buttons">
                <a href="{% url 'hr:leave_approval_list' %}" class="btn btn-warning">
                    <i class="fas fa-check-circle"></i> Review Approvals
                </a>
                <a href="{% url 'hr:leave_dashboard' %}" class="btn">
                    <i class="fas fa-chart-bar"></i> Team Leave Dashboard
                </a>
            </div>

            <!-- Show pending requests -->
            {% if pending_leaves %}
            <div class="table-container mt-3">
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Employee</th>
                                <th>Leave Type</th>
                                <th>Dates</th>
                                <th>Days</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for leave in pending_leaves %}
                            <tr>
                                <td>
                                    <strong>{{ leave.employee.full_name }}</strong><br>
                                    <small class="text-muted">{{ leave.employee.department }}</small>
                                </td>
                                <td>
                                    <span class="badge badge-info">{{ leave.leave_type.name }}</span>
                                </td>
                                <td>
                                    {{ leave.start_date|date:"M d" }} - {{ leave.end_date|date:"M d" }}
                                </td>
                                <td><strong>{{ leave.days_requested }}</strong> days</td>
                                <td class="action-links">
                                    <a href="{% url 'hr:leave_approve_reject' leave.id %}" class="action-link">
                                        <i class="fas fa-check"></i> Review
                                    </a>
                                    <a href="{% url 'hr:leave_detail' leave.id %}" class="action-link">
                                        <i class="fas fa-eye"></i> View
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- HR Leave Management Section -->
        {% if is_hr %}
        <div class="card hr">
            <div class="card-header">
                <div>
                    <h2 class="card-title">
                        <i class="fas fa-users-cog"></i>
                        HR Leave Management
                    </h2>
                    <p class="card-subtitle">
                        You have full control over all leave and absence records.
                    </p>
                </div>
                <div class="card-icon">
                    <i class="fas fa-tasks"></i>
                </div>
            </div>

            <div class="action-buttons">
                <a href="{% url 'hr:hr_leave_management' %}" class="btn btn-danger">
                    <i class="fas fa-cogs"></i> Manage All Leaves
                </a>
                <a href="{% url 'hr:hr_leave_add' %}" class="btn btn-warning">
                    <i class="fas fa-user-times"></i> Add Absence Record
                </a>
                <a href="{% url 'hr:leave_approval_list' %}" class="btn">
                    <i class="fas fa-check-circle"></i> Approve Leaves
                </a>
                <a href="{% url 'hr:finance_leaves_view' %}" class="btn btn-success">
                    <i class="fas fa-calculator"></i> Payroll Processing
                </a>
            </div>
        </div>
        {% endif %}

        <!-- Today's Absences Alert -->
        {% if active_absences > 0 %}
        <div class="card danger">
            <div class="card-header">
                <div>
                    <h2 class="card-title">
                        <i class="fas fa-exclamation-triangle"></i>
                        Today's Absences
                    </h2>
                    <p class="card-subtitle">
                        <strong>{{ active_absences }}</strong> employees are absent today.
                    </p>
                </div>
                <div class="card-icon">
                    <i class="fas fa-user-times"></i>
                </div>
            </div>
            <div class="action-buttons">
                <a href="{% url 'hr:hr_leave_management' %}?status=approved&date=today" class="btn btn-danger">
                    <i class="fas fa-list"></i> View Absence List
                </a>
            </div>
        </div>
        {% endif %}

        <!-- Recent Employees -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-user-friends"></i>
                    Recent Employees
                </h2>
                <a href="{% url 'hr:employee_list' %}" class="btn btn-sm">
                    <i class="fas fa-eye"></i> View All
                </a>
            </div>
            
            <div class="table-container">
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Employee ID</th>
                                <th>Full Name</th>
                                <th>Department</th>
                                <th>Position</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for emp in employees %}
                            <tr>
                                <td><strong>{{ emp.employee_id }}</strong></td>
                                <td>{{ emp.full_name }}</td>
                                <td>{{ emp.department }}</td>
                                <td>{{ emp.position }}</td>
                                <td>
                                    {% if emp.is_active %}
                                        <span class="badge badge-success">Active</span>
                                    {% else %}
                                        <span class="badge badge-danger">Inactive</span>
                                    {% endif %}
                                </td>
                                <td class="action-links">
                                    <a href="{% url 'hr:employee_detail' emp.id %}" class="action-link">
                                        <i class="fas fa-eye"></i> View
                                    </a>
                                    <a href="{% url 'hr:employee_update' emp.id %}" class="action-link">
                                        <i class="fas fa-edit"></i> Edit
                                    </a>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="text-center p-4">
                                    <div class="empty-state">
                                        <i class="fas fa-user-friends"></i>
                                        <h3>No Employees Found</h3>
                                        <p>Start by adding your first employee</p>
                                        <a href="{% url 'hr:employee_create' %}" class="btn btn-success">
                                            <i class="fas fa-user-plus"></i> Add First Employee
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="{% static 'js/hr-main.js' %}"></script>
</body>
</html>