{% extends 'marketing/base.html' %}

{% block title %}Sales - Marketing{% endblock %}

{% block content %}
<h1>Sales</h1>
<a href="{% url 'marketing:sale_create' %}" class="btn btn-success">Record New Sale</a>

<!-- Summary Cards -->
<div style="display: flex; gap: 20px; margin: 20px 0;">
    <div class="card" style="flex: 1;">
        <h3>Total Sales</h3>
        <p style="font-size: 24px; color: #27ae60;">${{ total_sales|floatformat:2 }}</p>
    </div>
    <div class="card" style="flex: 1;">
        <h3>Paid Amount</h3>
        <p style="font-size: 24px; color: #27ae60;">${{ paid_amount|floatformat:2 }}</p>
    </div>
    <div class="card" style="flex: 1;">
        <h3>Pending Amount</h3>
        <p style="font-size: 24px; color: #f39c12;">${{ pending_amount|floatformat:2 }}</p>
    </div>
    <div class="card" style="flex: 1;">
        <h3>Overdue Amount</h3>
        <p style="font-size: 24px; color: #e74c3c;">${{ overdue_amount|floatformat:2 }}</p>
    </div>
</div>

<!-- Sales Table -->
<table>
    <thead>
        <tr>
            <th>Invoice #</th>
            <th>Contract</th>
            <th>Customer</th>
            <th>Quantity</th>
            <th>Unit Price</th>
            <th>Total</th>
            <th>Sales Person</th>
            <th>Date</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for sale in sales %}
        <tr>
            <td>{{ sale.invoice_number|default:"-" }}</td>
            <td>{{ sale.contract.contract_number }}</td>
            <td>{{ sale.contract.customer.name }}</td>
            <td>{{ sale.quantity }}</td>
            <td>${{ sale.unit_price|floatformat:2 }}</td>
            <td>${{ sale.total_price|floatformat:2 }}</td>
            <td>{{ sale.sales_person.full_name|default:"-" }}</td>
            <td>{{ sale.sale_date }}</td>
            <td>
                {% if sale.payment_status == 'Paid' %}
                    <span style="color: #27ae60;">Paid</span>
                {% elif sale.payment_status == 'Overdue' %}
                    <span style="color: #e74c3c;">Overdue</span>
                {% else %}
                    <span style="color: #f39c12;">{{ sale.payment_status }}</span>
                {% endif %}
            </td>
            <td>
                <a href="{% url 'marketing:sale_detail' sale.pk %}" class="btn">View</a>
                <a href="{% url 'marketing:sale_update' sale.pk %}" class="btn">Edit</a>
                {% if sale.payment_status != 'Paid' %}
                    <a href="{% url 'marketing:sale_mark_paid' sale.pk %}" class="btn btn-success">Mark Paid</a>
                {% endif %}
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="10" style="text-align: center; padding: 30px;">
                No sales found. <a href="{% url 'marketing:sale_create' %}">Record the first sale</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}